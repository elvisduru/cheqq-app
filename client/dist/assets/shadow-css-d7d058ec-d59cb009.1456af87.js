var P=globalThis&&globalThis.__spreadArrays||function(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var o=Array(r),a=0,e=0;e<t;e++)for(var n=arguments[e],i=0,c=n.length;i<c;i++,a++)o[a]=n[i];return o};/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 *
 * This file is a port of shadowCSS from webcomponents.js to TypeScript.
 * https://github.com/webcomponents/webcomponentsjs/blob/4efecd7e0e/src/ShadowCSS/ShadowCSS.js
 * https://github.com/angular/angular/blob/master/packages/compiler/src/shadow_css.ts
 */var N=function(r){var e=[],t=0,o;r=r.replace(/(\[[^\]]*\])/g,function(n,i){var c="__ph-"+t+"__";return e.push(i),t++,c}),o=r.replace(/(:nth-[-\w]+)(\([^)]+\))/g,function(n,i,c){var v="__ph-"+t+"__";return e.push(c),t++,i+v});var a={content:o,placeholders:e};return a},j=function(r,e){return e.replace(/__ph-(\d+)__/g,function(t,o){return r[+o]})},_="-shadowcsshost",W="-shadowcssslotted",E="-shadowcsscontext",y=")(?:\\(((?:\\([^)(]*\\)|[^)(]*)+?)\\))?([^,{]*)",A=new RegExp("("+_+y,"gim"),M=new RegExp("("+E+y,"gim"),D=new RegExp("("+W+y,"gim"),m=_+"-no-combinator",K=/-shadowcsshost-no-combinator([^\s]*)/,U=[/::shadow/g,/::content/g],Y="([>\\s~+[.,{:][\\s\\S]*)?$",H=/-shadowcsshost/gim,$=/:host/gim,q=/::slotted/gim,z=/:host-context/gim,F=/\/\*\s*[\s\S]*?\*\//g,G=function(r){return r.replace(F,"")},I=/\/\*\s*#\s*source(Mapping)?URL=[\s\S]+?\*\//g,J=function(r){return r.match(I)||[]},Q=/(\s*)([^;\{\}]+?)(\s*)((?:{%BLOCK%}?\s*;?)|(?:\s*;))/g,V=/([{}])/g,X="{",Z="}",S="%BLOCK%",b=function(r,e){var t=x(r),o=0;return t.escapedString.replace(Q,function(){for(var a=[],n=0;n<arguments.length;n++)a[n]=arguments[n];var i=a[2],c="",v=a[4],s="";v&&v.startsWith("{"+S)&&(c=t.blocks[o++],v=v.substring(S.length+1),s="{");var l={selector:i,content:c},u=e(l);return""+a[1]+u.selector+a[3]+s+u.content+v})},x=function(r){for(var e=r.split(V),t=[],o=[],a=0,n=[],i=0;i<e.length;i++){var c=e[i];c===Z&&a--,a>0?n.push(c):(n.length>0&&(o.push(n.join("")),t.push(S),n=[]),t.push(c)),c===X&&a++}n.length>0&&(o.push(n.join("")),t.push(S));var v={escapedString:t.join(""),blocks:o};return v},T=function(r){return r=r.replace(z,E).replace($,_).replace(q,W),r},k=function(r,e,t){return r.replace(e,function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];if(o[2]){for(var n=o[2].split(","),i=[],c=0;c<n.length;c++){var v=n[c].trim();if(!v)break;i.push(t(m,v,o[3]))}return i.join(",")}else return m+o[3]})},w=function(r,e,t){return r+e.replace(_,"")+t},rr=function(r){return k(r,A,w)},er=function(r,e,t){return e.indexOf(_)>-1?w(r,e,t):r+e+t+", "+e+" "+r+t},tr=function(r,e){var t="."+e+" > ",o=[];return r=r.replace(D,function(){for(var a=[],n=0;n<arguments.length;n++)a[n]=arguments[n];if(a[2]){for(var i=a[2].trim(),c=a[3],v=t+i+c,s="",l=a[4]-1;l>=0;l--){var u=a[5][l];if(u==="}"||u===",")break;s=u+s}var f=s+v,R=""+s.trimRight()+v.trim();if(f.trim()!==R.trim()){var g=R+", "+f;o.push({orgSelector:f,updatedSelector:g})}return v}else return m+a[3]}),{selectors:o,cssText:r}},nr=function(r){return k(r,M,er)},ar=function(r){return U.reduce(function(e,t){return e.replace(t," ")},r)},or=function(r){var e=/\[/g,t=/\]/g;return r=r.replace(e,"\\[").replace(t,"\\]"),new RegExp("^("+r+")"+Y,"m")},sr=function(r,e){var t=or(e);return!t.test(r)},cr=function(r,e,t){if(H.lastIndex=0,H.test(r)){var o="."+t;return r.replace(K,function(a,n){return n.replace(/([^:]*)(:*)(.*)/,function(i,c,v,s){return c+o+v+s})}).replace(H,o+" ")}return e+" "+r},ir=function(r,e,t){var o=/\[is=([^\]]*)\]/g;e=e.replace(o,function(d){for(var p=[],h=1;h<arguments.length;h++)p[h-1]=arguments[h];return p[0]});var a="."+e,n=function(d){var p=d.trim();if(!p)return"";if(d.indexOf(m)>-1)p=cr(d,e,t);else{var h=d.replace(H,"");if(h.length>0){var C=h.match(/([^:]*)(:*)(.*)/);C&&(p=C[1]+a+C[2]+C[3])}}return p},i=N(r);r=i.content;for(var c="",v=0,s,l=/( |>|\+|~(?!=))\s*/g,u=r.indexOf(m)>-1,f=!u;(s=l.exec(r))!==null;){var R=s[1],g=r.slice(v,s.index).trim();f=f||g.indexOf(m)>-1;var L=f?n(g):g;c+=L+" "+R+" ",v=l.lastIndex}var O=r.substring(v);return f=f||O.indexOf(m)>-1,c+=f?n(O):O,j(i.placeholders,c)},vr=function(r,e,t,o){return r.split(",").map(function(a){return o&&a.indexOf("."+o)>-1?a.trim():sr(a,e)?ir(a,e,t).trim():a.trim()}).join(", ")},B=function(r,e,t,o,a){return b(r,function(n){var i=n.selector,c=n.content;n.selector[0]!=="@"?i=vr(n.selector,e,t,o):(n.selector.startsWith("@media")||n.selector.startsWith("@supports")||n.selector.startsWith("@page")||n.selector.startsWith("@document"))&&(c=B(n.content,e,t,o));var v={selector:i.replace(/\s{2,}/g," ").trim(),content:c};return v})},lr=function(r,e,t,o,a){r=T(r),r=rr(r),r=nr(r);var n=tr(r,o);return r=n.cssText,r=ar(r),e&&(r=B(r,e,t,o)),r=r.replace(/-shadowcsshost-no-combinator/g,"."+t),r=r.replace(/>\s*\*\s+([^{, ]+)/gm," $1 "),{cssText:r.trim(),slottedSelectors:n.selectors}},ur=function(r,e,t){var o=e+"-h",a=e+"-s",n=J(r);r=G(r);var i=[];if(t){var c=function(s){var l="/*!@___"+i.length+"___*/",u="/*!@"+s.selector+"*/";return i.push({placeholder:l,comment:u}),s.selector=l+s.selector,s};r=b(r,function(s){return s.selector[0]!=="@"?c(s):((s.selector.startsWith("@media")||s.selector.startsWith("@supports")||s.selector.startsWith("@page")||s.selector.startsWith("@document"))&&(s.content=b(s.content,c)),s)})}var v=lr(r,e,o,a);return r=P([v.cssText],n).join(`
`),t&&i.forEach(function(s){var l=s.placeholder,u=s.comment;r=r.replace(l,u)}),v.slottedSelectors.forEach(function(s){r=r.replace(s.orgSelector,s.updatedSelector)}),r};export{ur as scopeCss};
